From 0a23fabd5b4bff152047ba0cffbc2b67592645d1 Mon Sep 17 00:00:00 2001
From: Kovid Goyal <kovid@kovidgoyal.net>
Date: Thu, 16 Nov 2023 19:26:12 +0530
Subject: [PATCH] Skip test that breaks because of sqlite bug on the broken
 version of sqlite

---
 src/calibre/db/tests/fts.py | 5 ++++-
 1 file changed, 4 insertions(+), 1 deletion(-)

diff --git a/src/calibre/db/tests/fts.py b/src/calibre/db/tests/fts.py
index a71911bc1451..717a331999ae 100644
--- a/src/calibre/db/tests/fts.py
+++ b/src/calibre/db/tests/fts.py
@@ -142,7 +142,10 @@ def test_fts_basic(self):  # {{{
         self.ae(conn.search("mess"), [("你don't叫>mess<",)])
         self.ae(conn.search('''"don't"'''), [("你>don't<叫mess",)])
         self.ae(conn.search("你"), [(">你<don't叫mess",)])
-        self.ae(conn.search("叫"), [("你don't>叫<mess",)])
+        import apsw
+        if apsw.sqlitelibversion() not in ('3.44.0', '3.44.1', '3.44.2'):
+            # see https://www.sqlite.org/forum/forumpost/d16aeb397d
+            self.ae(conn.search("叫"), [("你don't>叫<mess",)])
     # }}}
 
     def test_fts_stemming(self):  # {{{
