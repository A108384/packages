name       : eopkg4-bin
version    : 4.0.0
release    : 1
source     :
    - git|https://github.com/getsolus/eopkg : 0bcb2e75ea1f5deaf40a3a3bb4f1665461931f32
    - git|https://github.com/getsolus/PackageKit.git : f53ab2959e13b55ba3f973988063bbac33e90b99
homepage   : https://github.com/getsolus/eopkg
license    : GPL-2.0-or-later
component  : system.base
summary    : "Python3 port of eopkg/pisi. WARNING: For testing only."
description: |
    Python3 port of eopkg/pisi, compiled with Nuitka. WARNING: this is for testing only and may break your system!
strip      : no
debug      : no
builddeps  :
    - pkgconfig(packagekit-glib2)
    - pkgconfig(python3)
    - nuitka
    - patchelf
    - python-build
    - python-installer
    - python-lxml
    - python-magic
    - python-packaging
    - python-wheel
    - python-zstandard
setup      : |
    %patch -p1 -i $pkgfiles/0001-Use-different-database.patch
    %python3_setup
build      : |
    # We're not actually using self-execution. In this case, eopkg is using the -c flag as shorthand for --component, rather than for passing the program as a string (as is default python behavior).
    nuitka3 --onefile --include-module=dbm.gnu --no-deployment-flag=self-execution $workdir/eopkg-cli
    nuitka3 --onefile --include-module=dbm.gnu $sources/PackageKit.git/backends/eopkg/eopkgBackend.py
install    : |
    install -Dm0755 $workdir/eopkg-cli.bin $installdir/usr/bin/eopkg4-bin
    install -Dm0755 $workdir/eopkgBackend.bin $installdir/usr/share/PackageKit/helpers/eopkg/eopkgBackend.bin
