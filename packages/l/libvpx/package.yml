# Updating this package? Run the create-vpx-testdata.sh script and if the hash of the test data changes
# then let Solus staff know so they can update the new test data to sources.getsol.us
name       : libvpx
version    : 1.13.1
release    : 19
source     :
    - https://github.com/webmproject/libvpx/archive/refs/tags/v1.13.1.tar.gz : 00dae80465567272abd077f59355f95ac91d7809a2d3006f9ace2637dd429d14
    - https://sources.getsol.us/libvpx/libvpx-test-data-e61272f0ef5d89fd.tar.zst : e61272f0ef5d89fdfcbcc9c444fdcb68e74300c96bf3e97bb4ae111b2cb85d85
homepage   : http://www.webmproject.org/
license    : MIT
component  : multimedia.codecs
summary    : Reference implementation of the VP8 & VP9 codec
description: |
    Reference implementation of the VP8 & VP9 codec
emul32     : yes
avx2       : yes
clang      : yes
optimize   :
    - lto
builddeps  :
    - yasm
environment: |
    export LIBVPX_TEST_DATA_PATH=$workdir/libvpx-test-data
setup      : |
    if [[ ! -z "${EMUL32BUILD}" ]]; then
        TARGET_CC=x86-linux-gcc
    else
        TARGET_CC=x86_64-linux-gcc
    fi

    tar xf $sources/libvpx-test-data*.tar.zst -C $workdir

    ./configure \
        --disable-static \
        --enable-shared \
        --enable-unit-tests \
        --enable-vp9-highbitdepth \
        --enable-vp9-postproc \
        --enable-vp9-temporal-denoising \
        --libdir=%libdir% \
        --prefix=/usr \
        --target=$TARGET_CC
build      : |
    %make
profile    : |
    LD_LIBRARY_PATH="$workdir:$LD_LIBRARY_PATH" %make exampletest-no-data-check
install    : |
    %make_install

    # No point in this file
    rm -v $installdir/%libdir%/libvpx.so.8.0
check      : |
    unset LD_PRELOAD
    LD_LIBRARY_PATH="$workdir:$LD_LIBRARY_PATH" %make exampletest-no-data-check
