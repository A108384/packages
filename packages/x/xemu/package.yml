name       : xemu
version    : 0.7.116
release    : 1
source     :
    - git|https://github.com/mborgerson/xemu.git : v0.7.116
license    :
    - GPL-2.0-or-later
    - MIT
    - BSD-2-CLAUSE
component  : game.emulator
homepage   : https://xbox.app
summary    : Original Xbox Emulator
description: |
    An open-source, cross-platform application that emulates the hardware of the original Xbox game console, allowing users to play their Xbox games on Windows, macOS, and Linux systems.
builddeps  :
    - pkgconfig(epoxy)
    - pkgconfig(glu)
    - pkgconfig(gtk+-3.0)
    - pkgconfig(keyutils)
    - pkgconfig(libpcap)
    - pkgconfig(liburing)
    - pkgconfig(pixman-1)
    - pkgconfig(samplerate)
    - pkgconfig(sdl2)
    - pkgconfig(slirp)
    - acpica-unix
networking : yes
environment: |
setup      : |
    ./configure $(sed 's|--runstatedir=/run||' <<< "%CONFOPTS%") \
    --extra-cflags="-DXBOX=1 -Wno-error=redundant-decls ${CFLAGS} -O3 -I$workdir/ui/imgui" \
    --target-list=i386-softmmu \
    --enable-lto --disable-werror
build      : |
    %make
install    : |
    install -v -d $installdir/usr/bin/
    install -v $workdir/build/qemu-system-i386 $installdir/usr/bin/xemu
    install -v -d $installdir/usr/share/applications/
    install -v $workdir/ui/xemu.desktop $installdir/usr/share/applications/
    install -v -d $installdir/usr/share/icons/

    # ensure that xemu icons end up in the right place with correct names
    pushd $workdir/ui/icons/
    source $pkgfiles/generate-xemu-icon-path.bash
    for icon in xemu_*.png; do
        full_path=$installdir/$(generate-xemu-icon-path $icon)
        dir_prefix=$(dirname $full_path)
        install -v -d $dir_prefix
        install -v $icon $full_path
    done
    unset full_path
    unset dir_prefix
    popd

    install -v -d $installdir/usr/share/xemu/
    cp -a $workdir/data $installdir/usr/share/xemu/
