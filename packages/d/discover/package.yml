name       : discover
version    : 6.0.4
release    : 10
source     :
    - https://download.kde.org/stable/plasma/6.0.4/discover-6.0.4.tar.xz : a056b0db89762e17cf4743f5a1abe4656850db2d5527bc732cf6180dc8d51aa8
homepage   : https://apps.kde.org/discover/
license    : GPL-2.0-or-later
component  : desktop.kde
summary    : UNSUPPORTED & EXPERIMENTAL (reserved for Solus Staff testing)
description: |
    WARNING: This package is **unsupported** and **experimental.**

    It is included at this early stage to make it easier for Solus Staff to test and debug it.

    Experienced contributors with packaging and bugreporting experience are welcome to help us test and report (non-duplicate!) problems here:

    See getsolus/packages#715 and getsolus/packages#716
clang      : yes
optimize   : thin-lto
builddeps  :
    - pkgconfig(Qt6Quick)
    - pkgconfig(Qt6WebView)
    - pkgconfig(flatpak)
    - pkgconfig(fwupd)
    - pkgconfig(libmarkdown)
    - pkgconfig(packagekitqt6)
    - appstream-qt6-devel
    - kf6-attica-devel
    - kf6-karchive-devel
    - kf6-kauth-devel
    - kf6-kcmutils-devel
    - kf6-kcrash-devel
    - kf6-kdbusaddons-devel
    - kf6-kidletime-devel
    - kf6-kio-devel
    - kf6-kirigami-devel
    - kf6-knewstuff-devel
    - kf6-knotifications-devel
    - kf6-kstatusnotifieritem-devel
    - kf6-kuserfeedback-devel
    - kf6-purpose-devel
    - kirigami-addons-devel
rundeps    :
    - kf6-kirigami
    - kf6-kitemmodels
    - kirigami-addons
setup      : |
    # https://github.com/getsolus/discover/commit/61ddf4e7b0ef774bf79b69dd4ea964cb1ddc2554
    %patch -p1 -i $pkgfiles/0001-PackageKitBackend-Add-the-Drivers-menu-filtered-by-t.patch
    %cmake_kf6 DPACKAGEKIT_AUTOREMOVE=ON
build      : |
    %ninja_build
install    : |
    %ninja_install

    # Remove docs
    rm -rfv $installdir/usr/share/doc

    # Duplicate with flatpak-kcm
    rm -v $installdir/usr/share/icons/hicolor/scalable/apps/flatpak-discover.svg

    # TODO: Remove once this is ready for user testing
    # - the goal is to ensure that Solus SC picks up the scary summary + description text
    rm -fr $installdir/usr/share/metainfo/
